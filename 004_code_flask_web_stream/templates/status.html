{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞{% endblock %}
{% block header %}–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞{% endblock %}

{% block content %}
    <div class="status-panel">
        <div class="status-row">
            <span>–°—Ç–∞—Ç—É—Å —Å—Ç—Ä–∏–º–∞:</span>
            <span id="stream-status">
                <span class="status-indicator inactive"></span>
                <strong>–ó–∞–≥—Ä—É–∑–∫–∞...</strong>
            </span>
        </div>
        <div class="status-row">
            <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–¥—Ä–æ–≤:</span>
            <span id="frame-count">0</span>
        </div>
        <div class="status-row">
            <span>–ö–∞–º–µ—Ä–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞:</span>
            <span id="camera-connected">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <div class="status-row">
            <span>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–∞–º–µ—Ä—ã:</span>
            <span id="camera-device">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <div class="status-row">
            <span>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</span>
            <span id="camera-resolution">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <div class="status-row">
            <span>FPS:</span>
            <span id="camera-fps">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        <div class="status-row">
            <span>–ö–∞—á–µ—Å—Ç–≤–æ JPEG:</span>
            <span id="jpeg-quality">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
    </div>
    
    <div style="margin-top: 30px;">
        <button class="btn btn-secondary" onclick="refreshStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <a href="/" class="btn btn-primary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>

    <script>
        async function loadStatus() {
            try {
                const response = await fetch('/api/stream/status');
                const status = await response.json();
                
                document.getElementById('stream-status').innerHTML = 
                    status.stream_active ? 
                    '<span class="status-indicator active"></span><strong>–ê–∫—Ç–∏–≤–µ–Ω</strong>' :
                    '<span class="status-indicator inactive"></span><strong>–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</strong>';
                
                document.getElementById('frame-count').textContent = status.frame_count;
                document.getElementById('camera-connected').textContent = 
                    status.camera_connected ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç';
                document.getElementById('camera-device').textContent = status.config.device;
                document.getElementById('camera-resolution').textContent = status.config.resolution;
                document.getElementById('camera-fps').textContent = status.config.fps;
                document.getElementById('jpeg-quality').textContent = status.config.jpeg_quality;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
            }
        }
        
        function refreshStatus() {
            loadStatus();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadStatus);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(loadStatus, 5000);
    </script>
{% endblock %}