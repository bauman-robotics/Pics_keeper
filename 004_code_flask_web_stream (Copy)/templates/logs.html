<!-- logs.html -->
{% extends "base.html" %}

{% block title %}–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞{% endblock %}
{% block header %}–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞{% endblock %}

{% block extra_css %}
<style>
    .log-container {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 15px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        max-height: 500px;
        overflow-y: auto;
        text-align: left;
        margin-bottom: 20px;
    }
    
    .log-entry {
        margin-bottom: 5px;
        padding: 5px;
        border-left: 3px solid #007acc;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    .log-entry.error { border-left-color: #f14c4c; }
    .log-entry.warning { border-left-color: #cca700; }
    .log-entry.info { border-left-color: #007acc; }
    .log-entry.button-click { border-left-color: #4ec9b0; }
    .log-entry.web-action { border-left-color: #c586c0; }
    
    .controls {
        margin-bottom: 20px;
    }
    
    .filter-controls {
        background: #252526;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
        text-align: left;
    }
</style>
{% endblock %}

{% block content %}
    <div class="controls">
        <button class="btn btn-secondary" onclick="fetchLogs()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ª–æ–≥–∏</button>
        <button class="btn btn-secondary" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        <button class="btn btn-secondary" onclick="refreshCameras()" title="–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–º–µ—Ä"> üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–∞–º–µ—Ä—ã
        <a href="/" class="btn btn-primary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>        
    </button>
    </div>
    
    <div class="filter-controls">
        <label><input type="checkbox" id="showErrors" checked> –û—à–∏–±–∫–∏</label>
        <label><input type="checkbox" id="showWarnings" checked> –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</label>
        <label><input type="checkbox" id="showInfo" checked> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
        <label><input type="checkbox" id="showButtonClicks" checked> –ù–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫</label>
        <label><input type="checkbox" id="showWebActions" checked> –í–µ–±-–¥–µ–π—Å—Ç–≤–∏—è</label>
    </div>
    
    <div id="logContainer" class="log-container">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>
    </div>

    <script>
        let autoRefreshInterval;
        
        function fetchLogs() {
            fetch('/api/logs')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('logContainer');
                    container.innerHTML = '';
                    
                    if (data.error) {
                        container.innerHTML = `<div class="error">–û—à–∏–±–∫–∞: ${data.error}</div>`;
                        return;
                    }
                    
                    data.logs.forEach(log => {
                        const entry = document.createElement('div');
                        entry.className = `log-entry ${log.type}`;
                        entry.textContent = log.message;
                        container.appendChild(entry);
                    });
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                    container.scrollTop = container.scrollHeight;
                })
                .catch(error => {
                    console.error('Error fetching logs:', error);
                    document.getElementById('logContainer').innerHTML = 
                        `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤: ${error.message}</div>`;
                });
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        document.getElementById('autoRefresh')?.addEventListener('change', function(e) {
            if (e.target.checked) {
                autoRefreshInterval = setInterval(fetchLogs, 10000);
            } else {
                clearInterval(autoRefreshInterval);
            }
        });
        
        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        fetchLogs();
        autoRefreshInterval = setInterval(fetchLogs, 10000);
    </script>
{% endblock %}