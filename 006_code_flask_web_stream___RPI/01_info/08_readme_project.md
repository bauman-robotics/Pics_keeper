# Проект Flask Web Stream для Raspberry Pi

## Описание проекта

Это комплексное веб-приложение на Flask для потоковой передачи видео с камер на Raspberry Pi. Проект поддерживает как USB веб-камеры, так и CSI камеры, предоставляя удобный веб-интерфейс для управления и просмотра потоков.

## Основные возможности

### Поддержка камер
- **USB веб-камеры** через V4L2 интерфейс
- **CSI камеры** (Camera Serial Interface) для Raspberry Pi
- Автоматическое обнаружение подключенных камер
- Поддержка нескольких камер одновременно

### Веб-интерфейс
- **Реальное время** потоковая передача видео
- **Управление камерами** через веб-браузер
- **Просмотр статуса** всех подключенных устройств
- **История логов** и диагностическая информация
- **Адаптивный дизайн** для мобильных устройств

### Диагностика и настройка
- **Автоматическая диагностика** проблем с камерами
- **Управление PipeWire** (система обработки мультимедиа)
- **Настройка разрешения** и FPS для каждой камеры
- **Фильтрация форматов** видео

## Архитектура проекта

### Основные компоненты
```
006_code_flask_web_stream___RPI/
├── 05_flask_webcam_stream__RPI.py    # Основной Flask сервер
├── 04_check_cam_and_get_pic___web_and_csi.py  # Скрипт проверки камер
├── config_rpi.yaml                    # Конфигурационный файл
├── templates/                         # HTML шаблоны
├── static/                            # CSS и JavaScript
├── utils_rpi/                         # Утилиты для Raspberry Pi
└── 01_info/                           # Документация
```

### Поток данных
1. **Инициализация** - сервер сканирует доступные камеры
2. **Потоковая передача** - видео кодируется и передается через HTTP
3. **Веб-интерфейс** - отображает потоки в реальном времени
4. **Управление** - пользователи могут настраивать параметры камер

## Установка и настройка

### Требования
- **Raspberry Pi** (рекомендуется Pi 4 и выше)
- **Python 3.7+**
- **OpenCV** для обработки видео
- **Flask** для веб-сервера
- **PiCamera** для CSI камер (опционально)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Настройка
1. Скопируйте `config_rpi.yaml.example` в `config_rpi.yaml`
2. Настройте параметры камер:
   - Разрешение видео
   - FPS
   - Источник камеры (USB/CSI)
3. Запустите сервер:
```bash
python 05_flask_webcam_stream__RPI.py
```

## Использование

### Доступ к веб-интерфейсу
- **URL**: `http://localhost:5000`
- **Порт**: 5000 (настраиваемый)
- **Просмотр**: Откройте в любом веб-браузере

### Управление камерами
- **Список камер** - отображаются все обнаруженные устройства
- **Настройки** - изменение разрешения и FPS
- **Запуск/остановка** - управление потоками
- **Диагностика** - проверка статуса камер

### Диагностика проблем
- **Проверка камер** - автоматическое обнаружение проблем
- **Логи** - подробная информация о работе системы
- **PipeWire** - управление системой мультимедиа

## Конфигурация

### Основные параметры config_rpi.yaml
```yaml
server:
  host: 0.0.0.0
  port: 5000
  debug: false

cameras:
  - type: usb
    device: /dev/video0
    resolution: [1280, 720]
    fps: 30
    format: mjpeg

  - type: csi
    device: pi-camera
    resolution: [1920, 1080]
    fps: 30
```

### Поддерживаемые форматы
- **MJPEG** - Motion JPEG
- **YUYV** - YUV формат
- **H264** - аппаратное кодирование (если поддерживается)

## Диагностика

### Автоматические инструменты
- **Сканирование камер** - обнаружение всех подключенных устройств
- **Проверка форматов** - проверка поддерживаемых форматов видео
- **Тестирование FPS** - измерение реальной частоты кадров
- **Диагностика PipeWire** - проверка системы мультимедиа

### Ручная диагностика
```bash
# Проверка доступных камер
v4l2-ctl --list-devices

# Диагностика PipeWire
systemctl status pipewire
```

## Безопасность

### Рекомендации
- **Сетевой доступ** - ограничьте доступ к localhost или используйте VPN
- **Аутентификация** - рекомендуется добавить базовую аутентификацию
- **Обновления** - регулярно обновляйте зависимости

## Вклад

### Структура проекта
- **Основной код** - в корне проекта
- **Утилиты** - в папке `utils_rpi/`
- **Документация** - в папке `01_info/`
- **Тестирование** - в папке `02_diagnostic/`

### Рекомендации по разработке
- **Python** - следуйте PEP 8
- **Flask** - используйте Blueprints для масштабирования
- **HTML/CSS** - адаптивный дизайн
- **Тестирование** - добавляйте unit тесты для новых функций

## Лицензия

Проект распространяется под [укажите лицензию].

## Контакты

Для вопросов и предложений:
- **Issues** - используйте GitHub Issues
- **Pull Requests** - вклад приветствуется
- **Documentation** - улучшения документации всегда нужны

---

**Версия**: 1.0.0  
**Последнее обновление**: 2026-02-01  
**Совместимость**: Raspberry Pi OS Buster и выше