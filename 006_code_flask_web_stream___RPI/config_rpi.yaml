# Конфигурационный файл для Flask Webcam Stream
# Версия 04 - Поддержка YAML конфигурации

# Параметры сервера
server:
  host: "0.0.0.0"           # Хост для прослушивания
  port: 5000                # Порт сервера
  debug: false              # Режим отладки
  threaded: true            # Многопоточный режим
  max_concurrent_streams: 10  # Добавьте эту строку

raspberry_pi: true  # <--- Флаг для Raspberry Pi
save_test_frame: false  # Сохранять тестовый кадр для проверки

  # Дополнительные настройки
rpi_settings:
  use_mjpg: true
  warmup_time: 0.5
  max_retries: 3

# Параметры камеры
camera:

  # === ВАРИАНТ 1: По номеру устройства ===
  # device: "/dev/video0"                 # /dev/video0 (первая USB камера)
  # device: "/dev/video2"                 # /dev/video2 (вторая USB камера - Logitech)
  device: "/dev/video4"          # /dev/video4 (третья USB камера - USB 2.0 HD 720P)
  
  # === ВАРИАНТ 2: Прямой путь ===
  # device: "/dev/video0"     # Прямой путь к первой USB камере
  # device: "/dev/video2"     # Прямой путь ко второй USB камере
  # device: "/dev/video4"     # Прямой путь к третьей USB камере
  
  # === ВАРИАНТ 3: CSI камера через Picamera2 ===
  # device: "csi_0"           # CSI камера IMX708 (первая)
  # device: "csi_1"           # CSI камера IMX415 (вторая)
  
  backend: "auto"           # Бэкенд: "auto", "v4l2", "picamera2", "direct"
  direct_path: "/dev/video0" # Прямой путь к устройству (используется при backend: "direct")
  
  
  # Разрешение и качество
  #width: 1280               # Ширина кадра
  #height: 720               # Высота кадра
  width: 640               # Ширина кадра
  height: 480               # Высота кадра

  fps: 15                   # Кадров в секунду
  
  # Настройки JPEG сжатия
  jpeg_quality: 85          # Качество JPEG (1-100)
  
  # Тестирование бэкендов (если backend: "auto")
  test_backends:
    - "picamera2"           # CSI камеры через Picamera2 (приоритет на RPi)
    - "direct_video0"       # Прямой доступ к /dev/video0
    - "direct_video2"       # Прямой доступ к /dev/video2  
    - "direct_video4"       # Прямой доступ к /dev/video4
    - "rpi_v4l2"            # V4L2 на Raspberry Pi
    - "default"             # Стандартный бэкенд
     
     
    # - "direct_video1"

# Параметры потока
stream:
  max_error_count: 20       # Максимальное количество ошибок чтения
  frame_log_interval: 60    # Интервал логирования (каждые N кадров)
  buffer_size: 30  # Размер буфера
  auto_start: true  # ← НОВЫЙ ПАРАМЕТР

# Пути
paths:
  templates_folder: "templates"  # Папка с HTML шаблонами
  log_file: "stream.log"           # Файл логов (опционально)

# Интервалы обновления
intervals:
  status_update: 2000       # Интервал обновления статуса (мс)
  error_retry_delay: 1000   # Задержка между попытками переподключения (мс)

# Дополнительные настройки
advanced:
  auto_restart: true        # Автоматический перезапуск при ошибках
  verbose_logging: true     # Подробное логирование
  enable_metrics: true      # Включить сбор метрик